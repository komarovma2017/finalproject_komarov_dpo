# ValutaTrade Hub

Платформа для отслеживания и симуляции торговли валютами.

## Описание

ValutaTrade Hub — это комплексная платформа, которая позволяет пользователям:
- Регистрироваться и управлять своим виртуальным портфелем
- Управлять фиатными и криптовалютами
- Совершать сделки по покупке/продаже
- Отслеживать актуальные курсы в реальном времени

## Структура проекта

```
finalproject_<фамилия>_<группа>/
│
├── data/                      # Данные приложения
│   ├── users.json            # Список пользователей
│   ├── portfolios.json       # Портфели и кошельки
│   └── rates.json            # Курсы валют
├── valutatrade_hub/          # Основной пакет
│   ├── __init__.py
│   ├── core/                 # Ядро приложения
│   │   ├── __init__.py
│   │   ├── models.py         # Модели данных
│   │   ├── utils.py          # Вспомогательные функции
│   │   └── usecases.py       # Бизнес-логика
│   └── cli/                  # Командный интерфейс
│       ├── __init__.py
│       └── interface.py      # CLI команды
├── main.py                   # Точка входа
├── Makefile                  # Команды для разработки
├── poetry.lock
├── pyproject.toml            # Конфигурация проекта
├── README.md                 # Документация
└── .gitignore               # Игнорируемые файлы
```

## Установка

### Требования

- Python 3.10+
- Poetry

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone <url>
cd finalproject_<фамилия>_<группа>
```

2. Установите зависимости:
```bash
make install
# или
poetry install
```

## Использование

### Запуск приложения

```bash
make run
# или
poetry run python main.py <команда> <аргументы>
```

### Доступные команды

#### 1. Регистрация нового пользователя

```bash
poetry run python main.py register --username alice --password 1234
```

**Выход:**
```
Пользователь 'alice' зарегистрирован (id=1). Войдите: login --username alice --password ****
```

#### 2. Вход в систему

```bash
poetry run python main.py login --username alice --password 1234
```

**Выход:**
```
Вы вошли как 'alice'
```

#### 3. Показать портфель

```bash
poetry run python main.py show-portfolio
# или с указанием базовой валюты
poetry run python main.py show-portfolio --base EUR
```

**Выход:**
```
Портфель пользователя 'alice' (база: USD):
- USD: 150.00  → 150.00 USD
- BTC: 0.0500  → 2,965.00 USD
- EUR: 200.00  → 214.00 USD
---------------------------------
ИТОГО: 3,329.00 USD
```

#### 4. Купить валюту

```bash
poetry run python main.py buy --currency BTC --amount 0.05
```

**Выход:**
```
Покупка выполнена: 0.0500 BTC по курсу 59,300.00 USD/BTC
Изменения в портфеле:
- BTC: было 0.0000 → стало 0.0500
Оценочная стоимость покупки: 2,965.00 USD
```

#### 5. Продать валюту

```bash
poetry run python main.py sell --currency BTC --amount 0.01
```

**Выход:**
```
Продажа выполнена: 0.0100 BTC по курсу 59,800.00 USD/BTC
Изменения в портфеле:
- BTC: было 0.0500 → стало 0.0400
Оценочная выручка: 598.00 USD
```

#### 6. Получить курс валют

```bash
poetry run python main.py get-rate --from USD --to BTC
```

**Выход:**
```
Курс USD→BTC: 0.00001685 (обновлено: 2025-10-09 00:03:22)
Обратный курс BTC→USD: 59,337.21
```

#### 7. Выход из системы

```bash
poetry run python main.py logout
```

## Разработка

### Форматирование кода

```bash
make format
# или
poetry run ruff format .
```

### Проверка кода

```bash
make lint
# или
poetry run ruff check .
```

### Полная проверка (форматирование + линтинг)

```bash
make check
```

### Очистка временных файлов

```bash
make clean
```

## Архитектура

### Модели данных (models.py)

- **User**: Управление пользователями с безопасным хешированием паролей
- **Wallet**: Кошелек для отдельной валюты с операциями пополнения/снятия
- **Portfolio**: Управление всеми кошельками пользователя

### Бизнес-логика (usecases.py)

- **AuthService**: Аутентификация и управление сессиями
- **PortfolioService**: Операции с портфелями (покупка/продажа)
- **RateService**: Получение курсов валют

### Утилиты (utils.py)

- **DataStorage**: Работа с JSON-хранилищем
- Валидаторы и форматеры

### CLI (interface.py)

- Командный интерфейс для взаимодействия с приложением
- Парсинг аргументов и выполнение команд

## Примеры использования

### Сценарий 1: Новый пользователь

```bash
# Регистрация
poetry run python main.py register --username bob --password securepass

# Вход
poetry run python main.py login --username bob --password securepass

# Покупка BTC
poetry run python main.py buy --currency BTC --amount 0.1

# Покупка EUR
poetry run python main.py buy --currency EUR --amount 500

# Просмотр портфеля
poetry run python main.py show-portfolio
```

### Сценарий 2: Проверка курсов

```bash
# Курс Bitcoin к доллару
poetry run python main.py get-rate --from BTC --to USD

# Курс евро к доллару
poetry run python main.py get-rate --from EUR --to USD

# Курс рубля к доллару
poetry run python main.py get-rate --from RUB --to USD
```

## Обработка ошибок

Приложение обрабатывает следующие типы ошибок:

- **Ошибки аутентификации**: неверный пароль, пользователь не найден
- **Ошибки валидации**: пустые поля, некорректные суммы
- **Ошибки портфеля**: недостаточно средств, отсутствие кошелька
- **Ошибки курсов**: недоступные валютные пары

## Хранение данных

Данные хранятся в JSON-файлах в директории `data/`:

- `users.json`: информация о пользователях
- `portfolios.json`: портфели и кошельки
- `rates.json`: актуальные курсы валют

## Безопасность

- Пароли хешируются с использованием SHA-256 и уникальной соли
- Соль генерируется для каждого пользователя отдельно
- Пароли никогда не хранятся в открытом виде

## Следующие этапы

- [ ] Реализация Parser Service для получения курсов из внешних API
- [ ] Добавление истории транзакций
- [ ] Реализация графического интерфейса
- [ ] Интеграция с реальными биржами

## Лицензия

MIT

## Автор

<Ваше имя> (<ваша группа>)
